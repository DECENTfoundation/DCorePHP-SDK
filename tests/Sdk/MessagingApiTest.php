<?php

namespace DCorePHPTests\Sdk;

use DCorePHP\Crypto\Credentials;
use DCorePHP\Crypto\ECKeyPair;
use DCorePHP\Model\ChainObject;
use DCorePHP\Model\Messaging\Message;
use DCorePHP\Model\Messaging\MessageResponse;
use DCorePHP\Model\Operation\SendMessageOperation;
use DCorePHP\Net\Model\Request\BaseRequest;
use DCorePHP\Net\Model\Request\BroadcastTransactionWithCallback;
use DCorePHP\Net\Model\Request\Database;
use DCorePHP\Net\Model\Request\GetDynamicGlobalProperties;
use DCorePHP\Net\Model\Request\GetMessageObjects;
use DCorePHP\Net\Model\Request\GetRequiredFees;
use DCorePHP\Net\Model\Request\Login;
use DCorePHP\Net\Model\Request\Messaging;
use DCorePHP\Net\Model\Request\NetworkBroadcast;
use DCorePHP\Net\Model\Response\BaseResponse;
use DCorePHP\Utils\Math;
use DCorePHPTests\DCoreSDKTest;

class MessagingApiTest extends DCoreSDKTest
{
    /**
     * @throws \DCorePHP\Exception\ValidationException
     */
    public function testGetAllOperations(): void
    {
        if ($this->websocketMock) {
            $this->websocketMock
                ->expects($this->exactly(3))
                ->method('send')
                ->withConsecutive(
                    [$this->callback(function(BaseRequest $req) { return $req->setId(1)->toJson() === '{"jsonrpc":"2.0","id":1,"method":"call","params":[1,"login",["",""]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(2)->toJson() === '{"jsonrpc":"2.0","id":2,"method":"call","params":[1,"messaging",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(3)->toJson() === '{"jsonrpc":"2.0","id":3,"method":"call","params":[6,"get_message_objects",[null,"1.2.35",1000]]}'; })]
                )
                ->will($this->onConsecutiveCalls(
                    Login::responseToModel(new BaseResponse('{"id":1,"result":true}')),
                    Messaging::responseToModel(new BaseResponse('{"id":2,"result":6}')),
                    GetMessageObjects::responseToModel(new BaseResponse('{"id":3,"result":[{"id":"2.18.3","created":"2019-02-22T11:41:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17391111264393218816","data":"4e2e37edec71eadba4eb8171f7ec1468dc8f5c9b5c218baef9447fd7b998fd83"}],"text":""},{"id":"2.18.4","created":"2019-02-22T11:42:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"9084912823086861056","data":"dbf804d15fc01cafa7380f66e008ac2549f0c67900a415d822a7ecc0397013e7"}],"text":""},{"id":"2.18.5","created":"2019-02-22T11:42:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"15712596674046053120","data":"05927f8341f72c1af709c076604482605f3180d1d71a99a64d96620e922c5b66"}],"text":""},{"id":"2.18.6","created":"2019-02-22T11:43:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"6523220187852098304","data":"d10fc732248baf8daf36c3e78bb8412c8602e0649e081d1e45410ced8dd66db0"}],"text":""},{"id":"2.18.7","created":"2019-02-22T11:46:25","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"5418653098442279680","data":"1eb0eb62c81bb84a6d91fc42d54d374498dded5c286b59e5b46490b78234d39c"}],"text":""},{"id":"2.18.8","created":"2019-02-22T11:46:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"16910704723097406208","data":"5ae4141456f1f7ed5525739426457266b8f84aeebdfe77c14358111cf80c4594"}],"text":""},{"id":"2.18.9","created":"2019-02-22T11:48:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17798987865604147968","data":"e1654daf4ee9ffc01aa460d5d6b6dbbb82d1fb88967c88691f1093a778f95d42"}],"text":""},{"id":"2.18.10","created":"2019-02-22T11:48:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17095986669189122816","data":"97d75766f62ac390d54f572b3c06e3f790567134753e2c0ff5adc3471b1312ff"}],"text":""},{"id":"2.18.11","created":"2019-02-22T11:50:50","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"716610381404359424","data":"6a5c230e0f5b7f449a279a10ceacc16c7e7e103c229f27dba3d95491cd427984"}],"text":""},{"id":"2.18.12","created":"2019-02-22T11:53:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"4764221389359926272","data":"fd71b9cbe050899358204513f1cb4f4ccd0115806d14b03f18d787de1633f6c2"}],"text":""},{"id":"2.18.13","created":"2019-02-22T14:11:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"2691640026145870592","data":"bdebc10baef29f5554beefafa4566a50f928379ffb6194e1b58f1fd9f02cc1a2"}],"text":""},{"id":"2.18.14","created":"2019-02-22T14:22:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"14691757747255038976","data":"af18f34442ff09acbfd6152c9a1e7aafe77a8f83fad12a1f04d248d702239081"}],"text":""},{"id":"2.18.15","created":"2019-02-22T14:23:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""},{"id":"2.18.16","created":"2019-02-22T15:04:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.17","created":"2019-02-22T15:20:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.18","created":"2019-02-22T15:21:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e6720617069"}],"text":""},{"id":"2.18.19","created":"2019-02-22T15:49:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.20","created":"2019-02-22T15:49:55","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.21","created":"2019-02-22T15:57:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""}]}'))
                ));
        }

        $messageResponses = $this->sdk->getMessagingApi()->getAllOperations(null, new ChainObject('1.2.35'));
        foreach ($messageResponses as $messageResponse) {
            $this->assertInstanceOf(MessageResponse::class, $messageResponse);
        }
    }

    /**
     * @throws \DCorePHP\Exception\ValidationException
     */
    public function testGetAll(): void
    {
        if ($this->websocketMock) {
            $this->websocketMock
                ->expects($this->exactly(3))
                ->method('send')
                ->withConsecutive(
                    [$this->callback(function(BaseRequest $req) { return $req->setId(1)->toJson() === '{"jsonrpc":"2.0","id":1,"method":"call","params":[1,"login",["",""]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(2)->toJson() === '{"jsonrpc":"2.0","id":2,"method":"call","params":[1,"messaging",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(3)->toJson() === '{"jsonrpc":"2.0","id":3,"method":"call","params":[6,"get_message_objects",["1.2.34",null,1000]]}'; })]
                )
                ->will($this->onConsecutiveCalls(
                    Login::responseToModel(new BaseResponse('{"id":1,"result":true}')),
                    Messaging::responseToModel(new BaseResponse('{"id":2,"result":6}')),
                    GetMessageObjects::responseToModel(new BaseResponse('{"id":6,"result":[{"id":"2.18.3","created":"2019-02-22T11:41:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17391111264393218816","data":"4e2e37edec71eadba4eb8171f7ec1468dc8f5c9b5c218baef9447fd7b998fd83"}],"text":""},{"id":"2.18.4","created":"2019-02-22T11:42:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"9084912823086861056","data":"dbf804d15fc01cafa7380f66e008ac2549f0c67900a415d822a7ecc0397013e7"}],"text":""},{"id":"2.18.5","created":"2019-02-22T11:42:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"15712596674046053120","data":"05927f8341f72c1af709c076604482605f3180d1d71a99a64d96620e922c5b66"}],"text":""},{"id":"2.18.6","created":"2019-02-22T11:43:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"6523220187852098304","data":"d10fc732248baf8daf36c3e78bb8412c8602e0649e081d1e45410ced8dd66db0"}],"text":""},{"id":"2.18.7","created":"2019-02-22T11:46:25","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"5418653098442279680","data":"1eb0eb62c81bb84a6d91fc42d54d374498dded5c286b59e5b46490b78234d39c"}],"text":""},{"id":"2.18.8","created":"2019-02-22T11:46:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"16910704723097406208","data":"5ae4141456f1f7ed5525739426457266b8f84aeebdfe77c14358111cf80c4594"}],"text":""},{"id":"2.18.9","created":"2019-02-22T11:48:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17798987865604147968","data":"e1654daf4ee9ffc01aa460d5d6b6dbbb82d1fb88967c88691f1093a778f95d42"}],"text":""},{"id":"2.18.10","created":"2019-02-22T11:48:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17095986669189122816","data":"97d75766f62ac390d54f572b3c06e3f790567134753e2c0ff5adc3471b1312ff"}],"text":""},{"id":"2.18.11","created":"2019-02-22T11:50:50","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"716610381404359424","data":"6a5c230e0f5b7f449a279a10ceacc16c7e7e103c229f27dba3d95491cd427984"}],"text":""},{"id":"2.18.12","created":"2019-02-22T11:53:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"4764221389359926272","data":"fd71b9cbe050899358204513f1cb4f4ccd0115806d14b03f18d787de1633f6c2"}],"text":""},{"id":"2.18.13","created":"2019-02-22T14:11:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"2691640026145870592","data":"bdebc10baef29f5554beefafa4566a50f928379ffb6194e1b58f1fd9f02cc1a2"}],"text":""},{"id":"2.18.14","created":"2019-02-22T14:22:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"14691757747255038976","data":"af18f34442ff09acbfd6152c9a1e7aafe77a8f83fad12a1f04d248d702239081"}],"text":""},{"id":"2.18.15","created":"2019-02-22T14:23:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""},{"id":"2.18.16","created":"2019-02-22T15:04:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.17","created":"2019-02-22T15:20:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.18","created":"2019-02-22T15:21:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e6720617069"}],"text":""},{"id":"2.18.19","created":"2019-02-22T15:49:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.20","created":"2019-02-22T15:49:55","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.21","created":"2019-02-22T15:57:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""},{"id":"2.18.22","created":"2019-03-14T10:54:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d20504850"}],"text":""},{"id":"2.18.23","created":"2019-03-14T13:06:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d20504850"}],"text":""},{"id":"2.18.24","created":"2019-03-14T13:16:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353639333635"}],"text":""},{"id":"2.18.25","created":"2019-03-14T13:17:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353639343635"}],"text":""},{"id":"2.18.26","created":"2019-03-14T13:29:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353730313638"}],"text":""},{"id":"2.18.27","created":"2019-03-14T16:26:00","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353830373630"}],"text":""}]}'))
                ));
        }

        $messages = $this->sdk->getMessagingApi()->getAll(new ChainObject(DCoreSDKTest::ACCOUNT_ID_1) );
        foreach ($messages as $message) {
            $this->assertInstanceOf(Message::class, $message);
        }
    }

    /**
     * @throws \DCorePHP\Exception\ValidationException
     * @throws \Exception
     */
    public function testGetAllDecryptedForSender(): void
    {
        if ($this->websocketMock) {
            $this->websocketMock
                ->expects($this->exactly(3))
                ->method('send')
                ->withConsecutive(
                    [$this->callback(function(BaseRequest $req) { return $req->setId(1)->toJson() === '{"jsonrpc":"2.0","id":1,"method":"call","params":[1,"login",["",""]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(2)->toJson() === '{"jsonrpc":"2.0","id":2,"method":"call","params":[1,"messaging",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(3)->toJson() === '{"jsonrpc":"2.0","id":3,"method":"call","params":[6,"get_message_objects",["1.2.34",null,1000]]}'; })]
                )
                ->will($this->onConsecutiveCalls(
                    Login::responseToModel(new BaseResponse('{"id":1,"result":true}')),
                    Messaging::responseToModel(new BaseResponse('{"id":2,"result":6}')),
                    GetMessageObjects::responseToModel(new BaseResponse('{"id":3,"result":[{"id":"2.18.3","created":"2019-02-22T11:41:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17391111264393218816","data":"4e2e37edec71eadba4eb8171f7ec1468dc8f5c9b5c218baef9447fd7b998fd83"}],"text":""},{"id":"2.18.4","created":"2019-02-22T11:42:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"9084912823086861056","data":"dbf804d15fc01cafa7380f66e008ac2549f0c67900a415d822a7ecc0397013e7"}],"text":""},{"id":"2.18.5","created":"2019-02-22T11:42:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"15712596674046053120","data":"05927f8341f72c1af709c076604482605f3180d1d71a99a64d96620e922c5b66"}],"text":""},{"id":"2.18.6","created":"2019-02-22T11:43:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"6523220187852098304","data":"d10fc732248baf8daf36c3e78bb8412c8602e0649e081d1e45410ced8dd66db0"}],"text":""},{"id":"2.18.7","created":"2019-02-22T11:46:25","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"5418653098442279680","data":"1eb0eb62c81bb84a6d91fc42d54d374498dded5c286b59e5b46490b78234d39c"}],"text":""},{"id":"2.18.8","created":"2019-02-22T11:46:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"16910704723097406208","data":"5ae4141456f1f7ed5525739426457266b8f84aeebdfe77c14358111cf80c4594"}],"text":""},{"id":"2.18.9","created":"2019-02-22T11:48:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17798987865604147968","data":"e1654daf4ee9ffc01aa460d5d6b6dbbb82d1fb88967c88691f1093a778f95d42"}],"text":""},{"id":"2.18.10","created":"2019-02-22T11:48:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17095986669189122816","data":"97d75766f62ac390d54f572b3c06e3f790567134753e2c0ff5adc3471b1312ff"}],"text":""},{"id":"2.18.11","created":"2019-02-22T11:50:50","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"716610381404359424","data":"6a5c230e0f5b7f449a279a10ceacc16c7e7e103c229f27dba3d95491cd427984"}],"text":""},{"id":"2.18.12","created":"2019-02-22T11:53:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"4764221389359926272","data":"fd71b9cbe050899358204513f1cb4f4ccd0115806d14b03f18d787de1633f6c2"}],"text":""},{"id":"2.18.13","created":"2019-02-22T14:11:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"2691640026145870592","data":"bdebc10baef29f5554beefafa4566a50f928379ffb6194e1b58f1fd9f02cc1a2"}],"text":""},{"id":"2.18.14","created":"2019-02-22T14:22:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"14691757747255038976","data":"af18f34442ff09acbfd6152c9a1e7aafe77a8f83fad12a1f04d248d702239081"}],"text":""},{"id":"2.18.15","created":"2019-02-22T14:23:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""},{"id":"2.18.16","created":"2019-02-22T15:04:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.17","created":"2019-02-22T15:20:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.18","created":"2019-02-22T15:21:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e6720617069"}],"text":""},{"id":"2.18.19","created":"2019-02-22T15:49:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.20","created":"2019-02-22T15:49:55","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.21","created":"2019-02-22T15:57:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""}]}'))
                ));
        }

        $credentials = new Credentials(new ChainObject(DCoreSDKTest::ACCOUNT_ID_1), ECKeyPair::fromBase58(DCoreSDKTest::PRIVATE_KEY_1));
        /** @var Message[] $messages */
        $messages = $this->sdk->getMessagingApi()->getAllDecryptedForSender($credentials);

        foreach ($messages as $message) {
            $this->assertInstanceOf(Message::class, $message);
            $this->assertEquals(DCoreSDKTest::ACCOUNT_ID_1, $message->getSender()->getId());
            $this->assertFalse($message->isEncrypted());
        }
    }

    /**
     * @throws \DCorePHP\Exception\ValidationException
     * @throws \Exception
     */
    public function testGetAllDecryptedForReceiver(): void
    {
        if ($this->websocketMock) {
            $this->websocketMock
                ->expects($this->exactly(3))
                ->method('send')
                ->withConsecutive(
                    [$this->callback(function(BaseRequest $req) { return $req->setId(1)->toJson() === '{"jsonrpc":"2.0","id":1,"method":"call","params":[1,"login",["",""]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(2)->toJson() === '{"jsonrpc":"2.0","id":2,"method":"call","params":[1,"messaging",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(3)->toJson() === '{"jsonrpc":"2.0","id":3,"method":"call","params":[6,"get_message_objects",[null,"1.2.35",1000]]}'; })]
                )
                ->will($this->onConsecutiveCalls(
                    Login::responseToModel(new BaseResponse('{"id":1,"result":true}')),
                    Messaging::responseToModel(new BaseResponse('{"id":2,"result":6}')),
                    GetMessageObjects::responseToModel(new BaseResponse('{"id":3,"result":[{"id":"2.18.3","created":"2019-02-22T11:41:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17391111264393218816","data":"4e2e37edec71eadba4eb8171f7ec1468dc8f5c9b5c218baef9447fd7b998fd83"}],"text":""},{"id":"2.18.4","created":"2019-02-22T11:42:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"9084912823086861056","data":"dbf804d15fc01cafa7380f66e008ac2549f0c67900a415d822a7ecc0397013e7"}],"text":""},{"id":"2.18.5","created":"2019-02-22T11:42:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"15712596674046053120","data":"05927f8341f72c1af709c076604482605f3180d1d71a99a64d96620e922c5b66"}],"text":""},{"id":"2.18.6","created":"2019-02-22T11:43:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"6523220187852098304","data":"d10fc732248baf8daf36c3e78bb8412c8602e0649e081d1e45410ced8dd66db0"}],"text":""},{"id":"2.18.7","created":"2019-02-22T11:46:25","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"5418653098442279680","data":"1eb0eb62c81bb84a6d91fc42d54d374498dded5c286b59e5b46490b78234d39c"}],"text":""},{"id":"2.18.8","created":"2019-02-22T11:46:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"16910704723097406208","data":"5ae4141456f1f7ed5525739426457266b8f84aeebdfe77c14358111cf80c4594"}],"text":""},{"id":"2.18.9","created":"2019-02-22T11:48:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17798987865604147968","data":"e1654daf4ee9ffc01aa460d5d6b6dbbb82d1fb88967c88691f1093a778f95d42"}],"text":""},{"id":"2.18.10","created":"2019-02-22T11:48:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17095986669189122816","data":"97d75766f62ac390d54f572b3c06e3f790567134753e2c0ff5adc3471b1312ff"}],"text":""},{"id":"2.18.11","created":"2019-02-22T11:50:50","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"716610381404359424","data":"6a5c230e0f5b7f449a279a10ceacc16c7e7e103c229f27dba3d95491cd427984"}],"text":""},{"id":"2.18.12","created":"2019-02-22T11:53:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"4764221389359926272","data":"fd71b9cbe050899358204513f1cb4f4ccd0115806d14b03f18d787de1633f6c2"}],"text":""},{"id":"2.18.13","created":"2019-02-22T14:11:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"2691640026145870592","data":"bdebc10baef29f5554beefafa4566a50f928379ffb6194e1b58f1fd9f02cc1a2"}],"text":""},{"id":"2.18.14","created":"2019-02-22T14:22:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"14691757747255038976","data":"af18f34442ff09acbfd6152c9a1e7aafe77a8f83fad12a1f04d248d702239081"}],"text":""},{"id":"2.18.15","created":"2019-02-22T14:23:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""},{"id":"2.18.16","created":"2019-02-22T15:04:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.17","created":"2019-02-22T15:20:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.18","created":"2019-02-22T15:21:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e6720617069"}],"text":""},{"id":"2.18.19","created":"2019-02-22T15:49:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.20","created":"2019-02-22T15:49:55","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.21","created":"2019-02-22T15:57:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""}]}'))
                ));
        }

        $credentials = new Credentials(new ChainObject(DCoreSDKTest::ACCOUNT_ID_2), ECKeyPair::fromBase58(DCoreSDKTest::PRIVATE_KEY_2));
        /** @var Message[] $messages */
        $messages = $this->sdk->getMessagingApi()->getAllDecryptedForReceiver($credentials);

        foreach ($messages as $message) {
            $this->assertInstanceOf(Message::class, $message);
            $this->assertEquals(DCoreSDKTest::ACCOUNT_ID_2, $message->getReceiver()->getId());
            $this->assertFalse($message->isEncrypted());
        }
    }

    public function testCreateMessageOperation(): void
    {
        $this->markTestIncomplete('This test has not been implemented yet.'); // @todo
    }

    public function testCreateMessageOperationMultiple(): void
    {
        $this->markTestIncomplete('This test has not been implemented yet.'); // @todo
    }

    /**
     * @throws \DCorePHP\Exception\ValidationException
     * @throws \Exception
     */
    public function testCreateMessageOperationUnencrypted(): void
    {
        $msg = 'hello messaging api unencrypted FROM PHP';
        $from = new ChainObject(DCoreSDKTest::ACCOUNT_ID_1);
        $to = new ChainObject(DCoreSDKTest::ACCOUNT_ID_2);
        $credentials = new Credentials($from, ECKeyPair::fromBase58(DCoreSDKTest::PRIVATE_KEY_1));
        $msgOp = $this->sdk->getMessagingApi()->createMessageOperationUnencrypted($credentials, $to, $msg);

        $this->assertEquals('1.2.34', $msgOp->getPayer()->getId());
        $this->assertEquals('7b2266726f6d223a22312e322e3334222c227265636569766572735f64617461223a5b7b22746f223a22312e322e3335222c2264617461223a2230303030303030303638363536633663366632303664363537333733363136373639366536373230363137303639323037353665363536653633373237393730373436353634323034363532346634643230353034383530227d5d7d', $msgOp->getData());
    }

    public function testCreateMessageOperationUnencryptedMultiple(): void
    {
        $this->markTestIncomplete('This test has not been implemented yet.'); // @todo
    }

    public function testSendMessage(): void
    {
        $this->markTestIncomplete('This test has not been implemented yet.'); // @todo
    }

    public function testSendMessageMultiple(): void
    {
        $this->markTestIncomplete('This test has not been implemented yet.'); // @todo
    }

    /**
     * @throws \DCorePHP\Exception\ValidationException
     * @throws \Exception
     */
    public function testSendUnencryptedMessage(): void
    {
        $time = time();
        $msg = "hello messaging api unencrypted FROM PHP at: {$time}";
        // Used in GetMessageObjects -> When mocking server ($msg is dynamic thanks to time() -> mock gets the same result every time)
        $msgHex = '00000000' . Math::byteArrayToHex(Math::stringToByteArray($msg));

        if ($this->websocketMock) {
            $this->websocketMock
                ->expects($this->exactly(9))
                ->method('send')
                ->withConsecutive(
                    [$this->callback(function(BaseRequest $req) { return $req->setId(1)->toJson() === '{"jsonrpc":"2.0","id":1,"method":"call","params":[1,"login",["",""]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(2)->toJson() === '{"jsonrpc":"2.0","id":2,"method":"call","params":[1,"database",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(3)->toJson() === '{"jsonrpc":"2.0","id":3,"method":"call","params":[6,"get_dynamic_global_properties",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(4)->toJson() === '{"jsonrpc":"2.0","id":4,"method":"call","params":[1,"database",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(5)->toJson() === '{"jsonrpc":"2.0","id":5,"method":"call","params":[6,"get_required_fees",[[[18,{"id":1,"payer":"1.2.34","required_auths":["1.2.34"],"data":"'. $req->getParams()[0][0][1]['data'] .'","fee":{"amount":0,"asset_id":"1.3.0"}}]],"1.3.0"]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(6)->toJson() === '{"jsonrpc":"2.0","id":6,"method":"call","params":[1,"network_broadcast",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(7)->toJson() === '{"jsonrpc":"2.0","id":7,"method":"call","params":[7,"broadcast_transaction_with_callback",[6,{"extensions":[],"operations":[[18,{"id":1,"payer":"1.2.34","required_auths":["1.2.34"],"data":"'. $req->getParams()[1]['operations'][0][1]['data'] .'","fee":{"amount":500001,"asset_id":"1.3.0"}}]],"ref_block_num":489,"ref_block_prefix":"2217158925","expiration":"'. $req->getParams()[1]['expiration'] .'","signatures":["'. $req->getParams()[1]['signatures'][0] .'"]}]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(8)->toJson() === '{"jsonrpc":"2.0","id":8,"method":"call","params":[1,"messaging",[]]}'; })],
                    [$this->callback(function(BaseRequest $req) { return $req->setId(9)->toJson() === '{"jsonrpc":"2.0","id":9,"method":"call","params":[8,"get_message_objects",["1.2.34",null,1000]]}'; })]
                )
                ->will($this->onConsecutiveCalls(
                    Login::responseToModel(new BaseResponse('{"id":1,"result":true}')),
                    Database::responseToModel(new BaseResponse('{"id":2,"result":6}')),
                    GetDynamicGlobalProperties::responseToModel(new BaseResponse('{"id":3,"result":{"id":"2.1.0","head_block_number":4719081,"head_block_id":"004801e90d292784fa7f89c0cba688ee61d56443","time":"2019-03-19T16:03:15","current_miner":"1.4.7","next_maintenance_time":"2019-03-20T00:00:00","last_budget_time":"2019-03-19T00:00:00","unspent_fee_budget":27921240,"mined_rewards":"350538000000","miner_budget_from_fees":61800264,"miner_budget_from_rewards":"639249000000","accounts_registered_this_interval":30,"recently_missed_count":3,"current_aslot":10837938,"recent_slots_filled":"251888583501648404804238534620062152573","dynamic_flags":0,"last_irreversible_block_num":4719081}}')),
                    Database::responseToModel(new BaseResponse('{"id":4,"result":6}')),
                    GetRequiredFees::responseToModel(new BaseResponse('{"id":5,"result":[{"amount":500001,"asset_id":"1.3.0"}]}')),
                    NetworkBroadcast::responseToModel(new BaseResponse('{"id":6,"result":7}')),
                    BroadcastTransactionWithCallback::responseToModel(new BaseResponse('{"id":7,"result":null}')),
                    Messaging::responseToModel(new BaseResponse('{"id":8,"result":8}')),
                    GetMessageObjects::responseToModel(new BaseResponse('{"id":9,"result":[{"id":"2.18.3","created":"2019-02-22T11:41:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17391111264393218816","data":"4e2e37edec71eadba4eb8171f7ec1468dc8f5c9b5c218baef9447fd7b998fd83"}],"text":""},{"id":"2.18.4","created":"2019-02-22T11:42:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"9084912823086861056","data":"dbf804d15fc01cafa7380f66e008ac2549f0c67900a415d822a7ecc0397013e7"}],"text":""},{"id":"2.18.5","created":"2019-02-22T11:42:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"15712596674046053120","data":"05927f8341f72c1af709c076604482605f3180d1d71a99a64d96620e922c5b66"}],"text":""},{"id":"2.18.6","created":"2019-02-22T11:43:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"6523220187852098304","data":"d10fc732248baf8daf36c3e78bb8412c8602e0649e081d1e45410ced8dd66db0"}],"text":""},{"id":"2.18.7","created":"2019-02-22T11:46:25","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"5418653098442279680","data":"1eb0eb62c81bb84a6d91fc42d54d374498dded5c286b59e5b46490b78234d39c"}],"text":""},{"id":"2.18.8","created":"2019-02-22T11:46:45","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"16910704723097406208","data":"5ae4141456f1f7ed5525739426457266b8f84aeebdfe77c14358111cf80c4594"}],"text":""},{"id":"2.18.9","created":"2019-02-22T11:48:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17798987865604147968","data":"e1654daf4ee9ffc01aa460d5d6b6dbbb82d1fb88967c88691f1093a778f95d42"}],"text":""},{"id":"2.18.10","created":"2019-02-22T11:48:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"17095986669189122816","data":"97d75766f62ac390d54f572b3c06e3f790567134753e2c0ff5adc3471b1312ff"}],"text":""},{"id":"2.18.11","created":"2019-02-22T11:50:50","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"716610381404359424","data":"6a5c230e0f5b7f449a279a10ceacc16c7e7e103c229f27dba3d95491cd427984"}],"text":""},{"id":"2.18.12","created":"2019-02-22T11:53:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"4764221389359926272","data":"fd71b9cbe050899358204513f1cb4f4ccd0115806d14b03f18d787de1633f6c2"}],"text":""},{"id":"2.18.13","created":"2019-02-22T14:11:40","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"2691640026145870592","data":"bdebc10baef29f5554beefafa4566a50f928379ffb6194e1b58f1fd9f02cc1a2"}],"text":""},{"id":"2.18.14","created":"2019-02-22T14:22:15","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"14691757747255038976","data":"af18f34442ff09acbfd6152c9a1e7aafe77a8f83fad12a1f04d248d702239081"}],"text":""},{"id":"2.18.15","created":"2019-02-22T14:23:20","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""},{"id":"2.18.16","created":"2019-02-22T15:04:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.17","created":"2019-02-22T15:20:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.18","created":"2019-02-22T15:21:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e6720617069"}],"text":""},{"id":"2.18.19","created":"2019-02-22T15:49:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.20","created":"2019-02-22T15:49:55","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e63727970746564"}],"text":""},{"id":"2.18.21","created":"2019-02-22T15:57:00","sender":"1.2.34","sender_pubkey":"DCT6MA5TQQ6UbMyMaLPmPXE2Syh5G3ZVhv5SbFedqLPqdFChSeqTz","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT6bVmimtYSvWQtwdrkVVQGHkVsTJZVKtBiUqf4YmJnrJPnk89QP","nonce":"10216254519122646016","data":"9b93c57410ea7d80ba6750819e06d6e2b7ba81cf91bbf7e31d265909b46790ad"}],"text":""},{"id":"2.18.22","created":"2019-03-14T10:54:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d20504850"}],"text":""},{"id":"2.18.23","created":"2019-03-14T13:06:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d20504850"}],"text":""},{"id":"2.18.24","created":"2019-03-14T13:16:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353639333635"}],"text":""},{"id":"2.18.25","created":"2019-03-14T13:17:45","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353639343635"}],"text":""},{"id":"2.18.26","created":"2019-03-14T13:29:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353730313638"}],"text":""},{"id":"2.18.27","created":"2019-03-14T16:26:00","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353830373630"}],"text":""},{"id":"2.18.28","created":"2019-03-14T16:27:35","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353830383536"}],"text":""},{"id":"2.18.29","created":"2019-03-14T16:29:20","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532353830393635"}],"text":""},{"id":"2.18.30","created":"2019-03-18T08:05:10","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532383936333130"}],"text":""},{"id":"2.18.31","created":"2019-03-18T08:47:40","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532383938383538"}],"text":""},{"id":"2.18.32","created":"2019-03-18T08:55:30","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532383939333239"}],"text":""},{"id":"2.18.33","created":"2019-03-18T08:59:15","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532383939353534"}],"text":""},{"id":"2.18.34","created":"2019-03-18T09:00:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532383939363237"}],"text":""},{"id":"2.18.35","created":"2019-03-18T09:12:55","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393030333736"}],"text":""},{"id":"2.18.36","created":"2019-03-18T09:15:40","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393030353430"}],"text":""},{"id":"2.18.37","created":"2019-03-18T09:17:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393030363435"}],"text":""},{"id":"2.18.38","created":"2019-03-18T11:59:00","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393130333433"}],"text":""},{"id":"2.18.39","created":"2019-03-18T11:59:55","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393130333937"}],"text":""},{"id":"2.18.40","created":"2019-03-18T13:04:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393134323438"}],"text":""},{"id":"2.18.41","created":"2019-03-18T13:06:10","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393134333639"}],"text":""},{"id":"2.18.42","created":"2019-03-18T13:28:10","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393135363935"}],"text":""},{"id":"2.18.43","created":"2019-03-19T08:44:00","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393835303433"}],"text":""},{"id":"2.18.44","created":"2019-03-19T08:50:15","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393835343137"}],"text":""},{"id":"2.18.45","created":"2019-03-19T09:22:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353532393837333532"}],"text":""},{"id":"2.18.46","created":"2019-03-19T15:47:35","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353533303130343536"}],"text":""},{"id":"2.18.47","created":"2019-03-19T15:48:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353533303130343834"}],"text":""},{"id":"2.18.48","created":"2019-03-19T15:52:05","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353533303130373235"}],"text":""},{"id":"2.18.49","created":"2019-03-19T15:57:20","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353533303131303335"}],"text":""},{"id":"2.18.50","created":"2019-03-19T16:01:25","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353533303131323838"}],"text":""},{"id":"2.18.51","created":"2019-03-19T16:02:30","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"0000000068656c6c6f206d6573736167696e672061706920756e656e637279707465642046524f4d205048502061743a2031353533303131333536"}],"text":""},{"id":"2.18.52","created":"2019-03-19T16:03:15","sender":"1.2.34","sender_pubkey":"DCT1111111111111111111111111111111114T1Anm","receivers_data":[{"receiver":"1.2.35","receiver_pubkey":"DCT1111111111111111111111111111111114T1Anm","nonce":0,"data":"'. $msgHex .'"}],"text":""}]}'))
                ));
        }

        $from = new ChainObject(DCoreSDKTest::ACCOUNT_ID_1);
        $to = new ChainObject(DCoreSDKTest::ACCOUNT_ID_2);
        $credentials = new Credentials($from, ECKeyPair::fromBase58(DCoreSDKTest::PRIVATE_KEY_1));
        $this->sdk->getMessagingApi()->sendUnencrypted($credentials, $to, $msg);

        /** @var Message[] $messages */
        $messages = $this->sdk->getMessagingApi()->getAllDecryptedForSender($credentials);
        $messageFound = false;
        foreach ($messages as $message) {
            if ($message->getMessage() === $msg) {
                $messageFound = true;
            }
        }
        $this->assertTrue($messageFound);
    }

    public function testSendMessageUnencryptedMultiple(): void
    {
        $this->markTestIncomplete('This test has not been implemented yet.'); // @todo
    }
}
